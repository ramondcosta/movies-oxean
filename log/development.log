  [1m[35m (2.8ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (0.1ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'development', '2024-03-19 08:44:23.325343', '2024-03-19 08:44:23.325347') RETURNING "key"[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
Migrating to CreateUsers (20240209211025)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "users" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "username" varchar, "email" varchar, "password_digest" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.1ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20240209211025') RETURNING "version"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[36mcommit transaction[0m
Migrating to CreateMovies (20240209212022)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "movies" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "title" varchar, "director" varchar, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL)[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.1ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20240209212022') RETURNING "version"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[36mcommit transaction[0m
Migrating to CreateUserMovies (20240209212036)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "user_movies" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer NOT NULL, "movie_id" integer NOT NULL, "score" integer, "created_at" datetime(6) NOT NULL, "updated_at" datetime(6) NOT NULL, CONSTRAINT "fk_rails_e6836e33a5"
FOREIGN KEY ("user_id")
  REFERENCES "users" ("id")
, CONSTRAINT "fk_rails_af7366483f"
FOREIGN KEY ("movie_id")
  REFERENCES "movies" ("id")
)[0m
  [1m[35m (0.1ms)[0m  [1m[35mCREATE INDEX "index_user_movies_on_user_id" ON "user_movies" ("user_id")[0m
  [1m[35m (0.1ms)[0m  [1m[35mCREATE INDEX "index_user_movies_on_movie_id" ON "user_movies" ("movie_id")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.1ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20240209212036') RETURNING "version"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[36mcommit transaction[0m
Migrating to AddAdminRoleToUsers (20240209222306)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.9ms)[0m  [1m[35mALTER TABLE "users" ADD "admin" boolean[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ('20240209222306') RETURNING "version"[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.0ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Create (1.1ms)[0m  [1m[32mINSERT INTO "users" ("username", "email", "password_digest", "created_at", "updated_at", "admin") VALUES (?, ?, ?, ?, ?, ?) RETURNING "id"[0m  [["username", "admin"], ["email", "admin@rotten"], ["password_digest", "[FILTERED]"], ["created_at", "2024-03-19 08:44:24.732488"], ["updated_at", "2024-03-19 08:44:24.732488"], ["admin", 1]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[36mcommit transaction[0m
Started GET "/movies?format=json" for ::1 at 2024-03-19 05:45:42 -0300
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
Processing by MoviesController#index as JSON
Redirected to http://localhost:3000/login
Filter chain halted as :authenticate_user! rendered or redirected
Completed 302 Found in 14ms (ActiveRecord: 0.0ms | Allocations: 3784)


Started GET "/login" for ::1 at 2024-03-19 05:45:42 -0300
Processing by SessionsController#new as */*
  Rendering layout layouts/application.html.erb
  Rendering sessions/new.html.erb within layouts/application
  Rendered sessions/new.html.erb within layouts/application (Duration: 3.8ms | Allocations: 3240)
  Rendered layout layouts/application.html.erb (Duration: 333.9ms | Allocations: 100956)
Completed 200 OK in 370ms (Views: 347.1ms | ActiveRecord: 0.0ms | Allocations: 107065)


Started GET "/" for ::1 at 2024-03-19 05:46:00 -0300
Processing by SessionsController#new as HTML
  Rendering layout layouts/application.html.erb
  Rendering sessions/new.html.erb within layouts/application
  Rendered sessions/new.html.erb within layouts/application (Duration: 3.4ms | Allocations: 2670)
  Rendered layout layouts/application.html.erb (Duration: 24.4ms | Allocations: 3860)
Completed 200 OK in 26ms (Views: 25.8ms | ActiveRecord: 0.0ms | Allocations: 4144)


Started POST "/sessions" for ::1 at 2024-03-19 05:46:12 -0300
Processing by SessionsController#create as TURBO_STREAM
  Parameters: {"authenticity_token"=>"[FILTERED]", "email"=>"admin@rotten", "password"=>"[FILTERED]", "commit"=>"Login"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "admin@rotten"], ["LIMIT", 1]]
  â†³ app/controllers/sessions_controller.rb:6:in `create'
Redirected to http://localhost:3000/movies
Completed 302 Found in 269ms (ActiveRecord: 2.0ms | Allocations: 24962)


Started GET "/movies" for ::1 at 2024-03-19 05:46:12 -0300
Processing by MoviesController#index as TURBO_STREAM
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  â†³ app/controllers/application_controller.rb:8:in `current_user'
  Rendering layout layouts/application.html.erb
  Rendering movies/index.html.erb within layouts/application
  [1m[36mMovie Load (0.3ms)[0m  [1m[34mSELECT "movies".* FROM "movies"[0m
  â†³ app/views/movies/index.html.erb:3
  Rendered movies/index.html.erb within layouts/application (Duration: 3.7ms | Allocations: 1113)
  Rendered layout layouts/application.html.erb (Duration: 7.8ms | Allocations: 2627)
Completed 200 OK in 18ms (Views: 9.0ms | ActiveRecord: 0.4ms | Allocations: 6076)


Started GET "/movies?format=json" for ::1 at 2024-03-19 05:46:58 -0300
Processing by MoviesController#index as JSON
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  â†³ app/controllers/application_controller.rb:8:in `current_user'
  [1m[36mMovie Load (0.2ms)[0m  [1m[34mSELECT "movies".* FROM "movies"[0m
  â†³ app/controllers/movies_controller.rb:8:in `block (2 levels) in index'
Completed 200 OK in 7ms (Views: 0.2ms | ActiveRecord: 0.4ms | Allocations: 1554)


Started GET "/movies/new" for ::1 at 2024-03-19 05:47:41 -0300
Processing by MoviesController#new as HTML
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  â†³ app/controllers/application_controller.rb:8:in `current_user'
  Rendering layout layouts/application.html.erb
  Rendering movies/new.html.erb within layouts/application
  Rendered movies/new.html.erb within layouts/application (Duration: 25.3ms | Allocations: 6151)
  Rendered layout layouts/application.html.erb (Duration: 29.9ms | Allocations: 7620)
Completed 200 OK in 44ms (Views: 30.7ms | ActiveRecord: 0.8ms | Allocations: 13020)


Started POST "/movies" for ::1 at 2024-03-19 05:47:53 -0300
Processing by MoviesController#create as TURBO_STREAM
  Parameters: {"authenticity_token"=>"[FILTERED]", "movie"=>{"title"=>"m1", "director"=>"d1"}, "commit"=>"Create Movie"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  â†³ app/controllers/application_controller.rb:8:in `current_user'
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[36mbegin transaction[0m
  â†³ app/controllers/movies_controller.rb:18:in `create'
  [1m[36mMovie Create (4.8ms)[0m  [1m[32mINSERT INTO "movies" ("title", "director", "created_at", "updated_at") VALUES (?, ?, ?, ?) RETURNING "id"[0m  [["title", "m1"], ["director", "d1"], ["created_at", "2024-03-19 08:47:53.707598"], ["updated_at", "2024-03-19 08:47:53.707598"]]
  â†³ app/controllers/movies_controller.rb:18:in `create'
  [1m[36mTRANSACTION (3.3ms)[0m  [1m[36mcommit transaction[0m
  â†³ app/controllers/movies_controller.rb:18:in `create'
Redirected to http://localhost:3000/movies
Completed 302 Found in 19ms (ActiveRecord: 8.2ms | Allocations: 4435)


Started GET "/movies" for ::1 at 2024-03-19 05:47:53 -0300
Processing by MoviesController#index as TURBO_STREAM
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  â†³ app/controllers/application_controller.rb:8:in `current_user'
  Rendering layout layouts/application.html.erb
  Rendering movies/index.html.erb within layouts/application
  [1m[36mMovie Load (0.2ms)[0m  [1m[34mSELECT "movies".* FROM "movies"[0m
  â†³ app/views/movies/index.html.erb:3
  [1m[36mUserMovie Average (0.1ms)[0m  [1m[34mSELECT AVG("user_movies"."score") FROM "user_movies" WHERE "user_movies"."movie_id" = ?[0m  [["movie_id", 1]]
  â†³ app/models/movie.rb:6:in `average_score'
  [1m[36mUserMovie Load (0.1ms)[0m  [1m[34mSELECT "user_movies".* FROM "user_movies" WHERE "user_movies"."user_id" = ? AND "user_movies"."movie_id" = ? LIMIT ?[0m  [["user_id", 1], ["movie_id", 1], ["LIMIT", 1]]
  â†³ app/views/movies/index.html.erb:8
  Rendered movies/index.html.erb within layouts/application (Duration: 50.3ms | Allocations: 16868)
  Rendered layout layouts/application.html.erb (Duration: 52.9ms | Allocations: 18361)
Completed 200 OK in 57ms (Views: 52.7ms | ActiveRecord: 1.0ms | Allocations: 19455)


Started POST "/user_movies" for ::1 at 2024-03-19 05:47:57 -0300
Processing by UserMoviesController#create as TURBO_STREAM
  Parameters: {"user_movie"=>{"movie_id"=>"1", "score"=>"4"}, "commit"=>"Rate"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  â†³ app/controllers/application_controller.rb:8:in `current_user'
  [1m[36mMovie Load (0.1ms)[0m  [1m[34mSELECT "movies".* FROM "movies" WHERE "movies"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  â†³ app/controllers/user_movies_controller.rb:5:in `create'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[36mbegin transaction[0m
  â†³ app/controllers/user_movies_controller.rb:6:in `create'
  [1m[36mUserMovie Create (2.6ms)[0m  [1m[32mINSERT INTO "user_movies" ("user_id", "movie_id", "score", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?) RETURNING "id"[0m  [["user_id", 1], ["movie_id", 1], ["score", nil], ["created_at", "2024-03-19 08:47:57.352537"], ["updated_at", "2024-03-19 08:47:57.352537"]]
  â†³ app/controllers/user_movies_controller.rb:6:in `create'
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[36mcommit transaction[0m
  â†³ app/controllers/user_movies_controller.rb:6:in `create'
  [1m[36mUserMovie Load (0.1ms)[0m  [1m[34mSELECT "user_movies".* FROM "user_movies" WHERE "user_movies"."user_id" = ? AND "user_movies"."movie_id" = ? LIMIT ?[0m  [["user_id", 1], ["movie_id", 1], ["LIMIT", 1]]
  â†³ app/controllers/user_movies_controller.rb:7:in `create'
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[36mbegin transaction[0m
  â†³ app/controllers/user_movies_controller.rb:8:in `create'
  [1m[36mUserMovie Update (1.7ms)[0m  [1m[33mUPDATE "user_movies" SET "score" = ?, "updated_at" = ? WHERE "user_movies"."id" = ?[0m  [["score", 4], ["updated_at", "2024-03-19 08:47:57.360545"], ["id", 1]]
  â†³ app/controllers/user_movies_controller.rb:8:in `create'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[36mcommit transaction[0m
  â†³ app/controllers/user_movies_controller.rb:8:in `create'
Redirected to http://localhost:3000/movies
Completed 302 Found in 36ms (ActiveRecord: 5.6ms | Allocations: 11112)


Started GET "/movies" for ::1 at 2024-03-19 05:47:57 -0300
Processing by MoviesController#index as TURBO_STREAM
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  â†³ app/controllers/application_controller.rb:8:in `current_user'
  Rendering layout layouts/application.html.erb
  Rendering movies/index.html.erb within layouts/application
  [1m[36mMovie Load (0.2ms)[0m  [1m[34mSELECT "movies".* FROM "movies"[0m
  â†³ app/views/movies/index.html.erb:3
  [1m[36mUserMovie Average (0.2ms)[0m  [1m[34mSELECT AVG("user_movies"."score") FROM "user_movies" WHERE "user_movies"."movie_id" = ?[0m  [["movie_id", 1]]
  â†³ app/models/movie.rb:6:in `average_score'
  [1m[36mUserMovie Load (0.3ms)[0m  [1m[34mSELECT "user_movies".* FROM "user_movies" WHERE "user_movies"."user_id" = ? AND "user_movies"."movie_id" = ? LIMIT ?[0m  [["user_id", 1], ["movie_id", 1], ["LIMIT", 1]]
  â†³ app/views/movies/index.html.erb:8
  Rendered movies/index.html.erb within layouts/application (Duration: 14.6ms | Allocations: 2486)
  Rendered layout layouts/application.html.erb (Duration: 20.0ms | Allocations: 3934)
Completed 200 OK in 25ms (Views: 20.8ms | ActiveRecord: 0.6ms | Allocations: 5135)


